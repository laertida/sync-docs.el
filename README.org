#+TITLE: sync-docs.el
#+AUTHOR: laertida
#+OPTIONS: toc:t num:nil
#+STARTUP: overview

* sync-docs.el - Publish Org-Mode files to Confluence from Emacs

[[https://github.com/laertida/sync-docs.el][sync-docs.el]] is an Emacs helper package to publish your Org-mode documentation directly to Atlassian Confluence. Write in Org, publish to your team’s wiki—complete with images and attachments!

#+BEGIN_QUOTE
Seamlessly export your org-mode files, including images, to Confluence, without leaving Emacs.
#+END_QUOTE

** Badges
:PROPERTIES:
:VISIBILITY: folded
:END:
[[https://img.shields.io/badge/License-MIT-yellow.svg][MIT License]]
[[https://img.shields.io/badge/emacs-29.1%2B-blue.svg][Emacs 29.1+]]

* Table of Contents
:TOC:
- [[#features][Features]]
- [[#installation][Installation]]
- [[#configuration][Configuration]]
- [[#usage][Usage]]
- [[#how-it-works][How it Works]]
- [[#troubleshooting][Troubleshooting]]
- [[#contributing][Contributing]]
- [[#license][License]]

* Features
- Export Org buffers as HTML, extracting only the body for clean Confluence publishing.
- Authenticate and interact with Confluence using email/user and API token.
- Create new pages or update existing ones in a configurable space and parent.
- Upload and update all =file= or =attachment= links as Confluence attachments.
- Customizable via Emacs variables; integrates smoothly with your workflow.
- Interactive command for quick publishing and version comments.

* Installation

** Requirements
- Emacs 29.1 or newer
- [[https://orgmode.org/][org-mode]] (builtin)
- [[https://github.com/tkf/emacs-request][request.el]]
- Access to a Confluence instance with REST API

** Using =straight.el= or =use-package=
#+begin_src emacs-lisp
(use-package sync-docs
  :load-path "path/to/sync-docs.el")
#+end_src

Or simply put =sync-docs.el= in your =load-path= and:

#+begin_src emacs-lisp
(require 'sync-docs)
#+end_src

* Configuration

Set the following variables (either via ~M-x customize-group RET sync-docs RET~ or in your init file):

#+begin_src emacs-lisp
(setq sync-docs-host "https://your-confluence-instance")
(setq sync-docs-user "your.email@example.com")
(setq sync-docs-token "your-api-token")
(setq sync-docs-space-id "SPACEKEY")
(setq sync-docs-default-parent-id "123456") ; Confluence parent page ID
#+end_src

* Usage

1. Open the Org file you want to publish.
2. Call the main command:
   #+begin_example
   M-x sync-docs
   #+end_example

   You will be prompted for:
   - *Status*: =draft= or =current=
   - *Message*: a comment for this version
   - *Update images*: =yes= or =no=

3. The package will:
   - Export the buffer to HTML
   - Create or update the Confluence page (under the configured space/parent)
   - Upload all image references as attachments
   - Track page/version metadata via Org properties

* How it Works

- *Authentication*: Uses HTTP Basic Auth with email and API token.
- *HTML Export*: Converts buffer to HTML, extracting only the <body> for Confluence.
- *Page Operations*: REST API calls for create/update, supporting versioning.
- *Images*: Uses =curl= under the hood to upload local images as attachments.
- *Sync Properties*: Stores sync metadata (IDs, version numbers) as Org properties.

* Troubleshooting
- Ensure your Confluence account has permission to publish and upload attachments.
- Double-check the API token and Confluence REST API accessibility.
- Use Emacs’ =*Messages*= buffer for debug information.

* Contributing

Contributions are welcome! Please open [[https://github.com/laertida/sync-docs.el/issues][issues]] or [[https://github.com/laertida/sync-docs.el/pulls][pull requests]].

* License

MIT © 2025 [[https://github.com/laertida][laertida]]
